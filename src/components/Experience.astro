---
import { Calendar } from "@lucide/astro";
import { getCollection } from "astro:content";

const experience = (await getCollection("experience")).sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime(),
);

const formatDate = (date) =>
  date.toLocaleDateString("es-CL", {
    year: "numeric",
    month: "short",
  });
---

<section id="experience" class="py-32 px-6">
  <div class="max-w-5xl mx-auto">
    <p class="text-primary text-xs tracking-[0.2em] uppercase mb-4">
      Experiencia Laboral
    </p>

    <h2 class="text-2xl md:text-3xl font-medium text-foreground mb-12">
      Trayectoria profesional
    </h2>

    <div class="relative">
      <div class="absolute left-0 md:left-4 top-0 bottom-0 w-px bg-white/8">
      </div>

      <div class="space-y-8">
        {
          experience.map((job) => (
            <article class="relative pl-8 md:pl-14">
              <div class="absolute left-0 md:left-4 top-1.5 w-2 h-2 -translate-x-1/2 rounded-full bg-primary shadow-lg shadow-primary/30" />

              <div class="p-5 rounded-xl border border-white/6 bg-white/3 backdrop-blur-sm">
                <div class="flex flex-wrap items-start justify-between gap-2 mb-2">
                  <div>
                    <h3 class="text-foreground font-medium">
                      {job.data.position}
                    </h3>
                    <p class="text-primary text-sm">{job.data.company}</p>
                  </div>

                  <span class="inline-flex items-center gap-1.5 text-muted-foreground text-xs">
                    <Calendar class="h-3" />
                    {formatDate(job.data.startDate)}
                    {" â€” "}
                    {job.data.endDate
                      ? formatDate(job.data.endDate)
                      : "Actualidad"}
                  </span>
                </div>

                <p class="text-muted-foreground text-sm leading-relaxed">
                  {job.data.summary}
                </p>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </div>
</section>
