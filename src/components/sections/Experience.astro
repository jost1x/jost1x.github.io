---
import { Calendar } from "@lucide/astro";
import { getCollection } from "astro:content";

const experience = (await getCollection("experience")).sort(
  (a, b) => b.data.startDate.getTime() - a.data.startDate.getTime(),
);

const formatDate = (date) =>
  date.toLocaleDateString("es-CL", {
    year: "numeric",
    month: "short",
  });
---

<section id="experience" class="px-6 py-32">
  <div class="mx-auto max-w-5xl">
    <p class="text-primary mb-4 text-xs tracking-[0.2em] uppercase">
      Experiencia Laboral
    </p>

    <h2 class="text-foreground mb-12 text-2xl font-medium md:text-3xl">
      Trayectoria profesional
    </h2>

    <div class="relative">
      <div class="absolute top-0 bottom-0 left-0 w-px bg-white/8 md:left-4">
      </div>

      <div class="space-y-8">
        {
          experience.map((job) => (
            <article class="relative pl-8 md:pl-14">
              <div class="bg-primary shadow-primary/30 absolute top-1.5 left-0 h-2 w-2 -translate-x-1/2 rounded-full shadow-lg md:left-4" />

              <div class="rounded-xl border border-white/6 bg-white/3 p-5 backdrop-blur-sm">
                <div class="mb-2 flex flex-wrap items-start justify-between gap-2">
                  <div>
                    <h3 class="text-foreground font-medium">
                      {job.data.position}
                    </h3>
                    <p class="text-primary text-sm">{job.data.company}</p>
                  </div>

                  <span class="text-muted-foreground inline-flex items-center gap-1.5 text-xs">
                    <Calendar class="h-3" />
                    {formatDate(job.data.startDate)}
                    {" â€” "}
                    {job.data.endDate
                      ? formatDate(job.data.endDate)
                      : "Actualidad"}
                  </span>
                </div>

                <p class="text-muted-foreground text-sm leading-relaxed">
                  {job.data.summary}
                </p>
              </div>
            </article>
          ))
        }
      </div>
    </div>
  </div>
</section>
